"use strict";Vue.component("status-indicator",{template:'<div class="cf-alert-wrap cf-hide"><p class="cf-alert cf-alert-success" v-if="show && success">{{message}}</p><p class="cf-alert cf-alert-warning" v-if="show && ! success">{{message}}</p></div>',props:["success","message","show"],watch:{show:function(){this.show?this.$el.className="cf-alert-wrap cf-show":this.$el.className="cf-alert-wrap cf-hide"}}});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t){t?(c[0]=c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0,this.blocks=c):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=0,this.finalized=this.hashed=!1,this.first=!0}var e="object"==("undefined"==typeof window?"undefined":_typeof(window))?window:{},i=!e.JS_SHA1_NO_NODE_JS&&"object"==("undefined"==typeof process?"undefined":_typeof(process))&&process.versions&&process.versions.node;i&&(e=global);var s=!e.JS_SHA1_NO_COMMON_JS&&"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports,n="function"==typeof define&&define.amd,o="0123456789abcdef".split(""),r=[-2147483648,8388608,32768,128],a=[24,16,8,0],h=["hex","array","digest","arrayBuffer"],c=[],u=function(e){return function(i){return new t(!0).update(i)[e]()}},f=function(t){var e=require("crypto"),i=require("buffer").Buffer;return function(s){if("string"==typeof s)return e.createHash("sha1").update(s,"utf8").digest("hex");if(s.constructor===ArrayBuffer)s=new Uint8Array(s);else if(void 0===s.length)return t(s);return e.createHash("sha1").update(new i(s)).digest("hex")}};t.prototype.update=function(t){if(!this.finalized){var i="string"!=typeof t;i&&t.constructor===e.ArrayBuffer&&(t=new Uint8Array(t));for(var s,n,o=0,r=t.length||0,h=this.blocks;r>o;){if(this.hashed&&(this.hashed=!1,h[0]=this.block,h[16]=h[1]=h[2]=h[3]=h[4]=h[5]=h[6]=h[7]=h[8]=h[9]=h[10]=h[11]=h[12]=h[13]=h[14]=h[15]=0),i)for(n=this.start;r>o&&64>n;++o)h[n>>2]|=t[o]<<a[3&n++];else for(n=this.start;r>o&&64>n;++o)s=t.charCodeAt(o),128>s?h[n>>2]|=s<<a[3&n++]:2048>s?(h[n>>2]|=(192|s>>6)<<a[3&n++],h[n>>2]|=(128|63&s)<<a[3&n++]):55296>s||s>=57344?(h[n>>2]|=(224|s>>12)<<a[3&n++],h[n>>2]|=(128|s>>6&63)<<a[3&n++],h[n>>2]|=(128|63&s)<<a[3&n++]):(s=65536+((1023&s)<<10|1023&t.charCodeAt(++o)),h[n>>2]|=(240|s>>18)<<a[3&n++],h[n>>2]|=(128|s>>12&63)<<a[3&n++],h[n>>2]|=(128|s>>6&63)<<a[3&n++],h[n>>2]|=(128|63&s)<<a[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=h[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this}},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=r[3&e],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[15]=this.bytes<<3,this.hash()}},t.prototype.hash=function(){var t,e,i,s=this.h0,n=this.h1,o=this.h2,r=this.h3,a=this.h4,h=this.blocks;for(e=16;80>e;++e)i=h[e-3]^h[e-8]^h[e-14]^h[e-16],h[e]=i<<1|i>>>31;for(e=0;20>e;e+=5)t=n&o|~n&r,i=s<<5|s>>>27,a=i+t+a+1518500249+h[e]<<0,n=n<<30|n>>>2,t=s&n|~s&o,i=a<<5|a>>>27,r=i+t+r+1518500249+h[e+1]<<0,s=s<<30|s>>>2,t=a&s|~a&n,i=r<<5|r>>>27,o=i+t+o+1518500249+h[e+2]<<0,a=a<<30|a>>>2,t=r&a|~r&s,i=o<<5|o>>>27,n=i+t+n+1518500249+h[e+3]<<0,r=r<<30|r>>>2,t=o&r|~o&a,i=n<<5|n>>>27,s=i+t+s+1518500249+h[e+4]<<0,o=o<<30|o>>>2;for(;40>e;e+=5)t=n^o^r,i=s<<5|s>>>27,a=i+t+a+1859775393+h[e]<<0,n=n<<30|n>>>2,t=s^n^o,i=a<<5|a>>>27,r=i+t+r+1859775393+h[e+1]<<0,s=s<<30|s>>>2,t=a^s^n,i=r<<5|r>>>27,o=i+t+o+1859775393+h[e+2]<<0,a=a<<30|a>>>2,t=r^a^s,i=o<<5|o>>>27,n=i+t+n+1859775393+h[e+3]<<0,r=r<<30|r>>>2,t=o^r^a,i=n<<5|n>>>27,s=i+t+s+1859775393+h[e+4]<<0,o=o<<30|o>>>2;for(;60>e;e+=5)t=n&o|n&r|o&r,i=s<<5|s>>>27,a=i+t+a-1894007588+h[e]<<0,n=n<<30|n>>>2,t=s&n|s&o|n&o,i=a<<5|a>>>27,r=i+t+r-1894007588+h[e+1]<<0,s=s<<30|s>>>2,t=a&s|a&n|s&n,i=r<<5|r>>>27,o=i+t+o-1894007588+h[e+2]<<0,a=a<<30|a>>>2,t=r&a|r&s|a&s,i=o<<5|o>>>27,n=i+t+n-1894007588+h[e+3]<<0,r=r<<30|r>>>2,t=o&r|o&a|r&a,i=n<<5|n>>>27,s=i+t+s-1894007588+h[e+4]<<0,o=o<<30|o>>>2;for(;80>e;e+=5)t=n^o^r,i=s<<5|s>>>27,a=i+t+a-899497514+h[e]<<0,n=n<<30|n>>>2,t=s^n^o,i=a<<5|a>>>27,r=i+t+r-899497514+h[e+1]<<0,s=s<<30|s>>>2,t=a^s^n,i=r<<5|r>>>27,o=i+t+o-899497514+h[e+2]<<0,a=a<<30|a>>>2,t=r^a^s,i=o<<5|o>>>27,n=i+t+n-899497514+h[e+3]<<0,r=r<<30|r>>>2,t=o^r^a,i=n<<5|n>>>27,s=i+t+s-899497514+h[e+4]<<0,o=o<<30|o>>>2;this.h0=this.h0+s<<0,this.h1=this.h1+n<<0,this.h2=this.h2+o<<0,this.h3=this.h3+r<<0,this.h4=this.h4+a<<0},t.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,s=this.h3,n=this.h4;return o[t>>28&15]+o[t>>24&15]+o[t>>20&15]+o[t>>16&15]+o[t>>12&15]+o[t>>8&15]+o[t>>4&15]+o[15&t]+o[e>>28&15]+o[e>>24&15]+o[e>>20&15]+o[e>>16&15]+o[e>>12&15]+o[e>>8&15]+o[e>>4&15]+o[15&e]+o[i>>28&15]+o[i>>24&15]+o[i>>20&15]+o[i>>16&15]+o[i>>12&15]+o[i>>8&15]+o[i>>4&15]+o[15&i]+o[s>>28&15]+o[s>>24&15]+o[s>>20&15]+o[s>>16&15]+o[s>>12&15]+o[s>>8&15]+o[s>>4&15]+o[15&s]+o[n>>28&15]+o[n>>24&15]+o[n>>20&15]+o[n>>16&15]+o[n>>12&15]+o[n>>8&15]+o[n>>4&15]+o[15&n]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,s=this.h3,n=this.h4;return[t>>24&255,t>>16&255,t>>8&255,255&t,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24&255,i>>16&255,i>>8&255,255&i,s>>24&255,s>>16&255,s>>8&255,255&s,n>>24&255,n>>16&255,n>>8&255,255&n]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};var d=function(){var e=u("hex");i&&(e=f(e)),e.create=function(){return new t},e.update=function(t){return e.create().update(t)};for(var s=0;s<h.length;++s){var n=h[s];e[n]=u(n)}return e}();s?module.exports=d:(e.sha1=d,n&&define(function(){return d}))}(),jQuery(function(t){var e=document.getElementById("cf-pro-layout-chooser").innerHTML,i=document.getElementById("cf-pro-checkbox").innerHTML,s=CF_PRO_ADMIN.api.cf.url,n=CF_PRO_ADMIN.api.cf.nonce,o=CF_PRO_ADMIN.api.cfPro.url;Vue.component("layout-chooser",{template:e,props:["form","layouts","setting","disabled"],methods:{layoutChanged:function(e){var i=t(e.target).val();this.$parent.$emit("layoutChosen",{form:this.form.form_id,selected:i,setting:this.setting})},idAttr:function(t){return"cf-pro-choose-template-"+t}},computed:{selected:function(){return this.form[this.setting]}}}),Vue.component("checkbox-setting",{template:i,props:["form","setting","label"],methods:{idAttr:function(t){return"cf-pro-"+this.setting+"-"+t},changed:function(e){var i=t(e.target).prop("checked");this.selected=i,this.$parent.$emit("checkboxChanged",{form:this.form.form_id,setting:this.setting,value:i})}},computed:{selected:function(){this.form[this.setting];return this.form[this.setting]}}});new Vue({el:"#cf-pro-message-settings",data:function(){return{apiKey:CF_PRO_ADMIN.settings.apiKeys.public,apiSecret:CF_PRO_ADMIN.settings.apiKeys.secret,apiConnected:!1,loaded:!1,enhancedDeliveryAllowed:!0,forms:CF_PRO_ADMIN.settings.forms,layouts:[],generatePDFs:!1,enhancedDelivery:CF_PRO_ADMIN.settings.enhancedDelivery,accountId:CF_PRO_ADMIN.settings.account_id,plan:"basic",loading:!1,accountActive:!0,alert:{show:!1,message:"",success:!0}}},created:function(){this.getLayouts(),this.testConnection(),this.listen()},methods:{save:function(){return this.update({forms:this.forms,apiKey:this.apiKey,apiSecret:this.apiSecret,generatePDFs:this.generatePDFs,enhancedDelivery:this.enhancedDelivery,accountId:this.accountId,plan:this.plan},!0)},update:function(e,i){var o=this;this.loading=!0,this.accountActive&&this.apiConnected?e.activate=!0:e.activate=!1,t.ajax(s,{method:"POST",data:e,beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",n)}}).then(function(t){o.loading=!1,i&&(o.alert.show=!1,window.setTimeout(function(){o.alert.message=CF_PRO_ADMIN.strings.saved,o.alert.success=!0,o.alert.show=!0},250))},function(t){o.loading=!1,i&&(o.alert.show=!1,window.setTimeout(function(){o.alert.message=CF_PRO_ADMIN.strings.notSaved,o.alert.success=!1,o.alert.show=!0},250))})},apiKeyChange:function(){if(!this.apiKey||!this.apiSecret)return!1;this.testConnection()},getLayouts:function(){var e=this;if(!this.hasAuth())return!1;this.loading=!0;var i=o+"/layouts/list?public="+this.apiKey+"&token="+sha1(this.apiKey+this.apiSecret)+"&simple=true";t.ajax(i,{method:"GET"}).then(function(t){e.layouts=t,e.loading=!1},function(t){e.loading=!1})},testConnection:function(){var e=this;if(!this.hasAuth())return this.loaded=!0,!1;this.loading=!0,t.ajax({method:"GET",data:{plan:this.plan,public:this.apiKey,token:sha1(this.apiKey+this.apiSecret)},url:o+"/account/verify"}).then(function(t){return e.accountId=t.id,t.active?(e.accountActive=!0,e.apiConnected=!0,e.loaded=!0,e.loading=!1,e.plan=t.plan,e.getLayouts(),e.update({apiKey:e.apiKey,apiSecret:e.apiSecret,accountId:e.accountId},!1)):(e.apiConnected=!1,e.loading=!1,e.loaded=!0,void(e.accountActive=!1))},function(t){console.log(t),console.log("not connected..."),e.apiConnected=!1,e.loaded=!0})},listen:function(){this.$on("layoutChosen",function(t){var e=this.forms.findIndex(function(e){return e.form_id==t.form});-1<e&&(this.forms[e][t.setting]=t.selected)}),this.$on("checkboxChanged",function(t){console.log(t);var e=this.forms.findIndex(function(e){return e.form_id==t.form});-1<e&&(this.forms[e][t.setting]=t.value)})},hasAuth:function(){return!(!this.apiKey||!this.apiSecret)||(this.apiConnected=!1,!1)}}})});